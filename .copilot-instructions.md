# GitHub Copilot Instructions for EFD CRM

## üéØ MANDATORY ARCHITECTURAL REQUIREMENTS

**ALL CODE SUGGESTIONS MUST FOLLOW THESE STRICT STANDARDS**

---

## üìê Modular MVC(C) Architecture - ENFORCED

### When suggesting code, ALWAYS follow this structure:

```
src/
‚îú‚îÄ‚îÄ app/api/[feature]/
‚îÇ   ‚îú‚îÄ‚îÄ model.js          # Data models ONLY
‚îÇ   ‚îú‚îÄ‚îÄ controller.js     # Request handling ONLY  
‚îÇ   ‚îú‚îÄ‚îÄ service.js        # Business logic ONLY
‚îÇ   ‚îî‚îÄ‚îÄ route.js          # API endpoints ONLY
‚îú‚îÄ‚îÄ services/[feature].service.js    # API calls ONLY
‚îú‚îÄ‚îÄ utils/[feature].util.js          # Pure functions ONLY  
‚îú‚îÄ‚îÄ components/[feature]/            # Modular components ONLY
‚îî‚îÄ‚îÄ schemas/[feature].schema.js      # Validation ONLY
```

---

## üö´ NEVER SUGGEST CODE THAT:

- Mixes business logic with controllers
- Puts API calls directly in components or pages
- Has multiple responsibilities in one function/component
- Uses inline complex logic in JSX
- Combines data fetching with UI rendering
- Puts database operations in controllers

---

## ‚úÖ ALWAYS SUGGEST CODE THAT:

### **Model Layer (`model.js`)**
```javascript
export class PaymentOrder {
    constructor(data) {
        // ONLY data structure and simple transformations
        this.id = data.id;
        this.clientId = data.clientId;
        this.status = data.status || 'pending';
    }
    
    toObject() {
        return { /* return plain object */ };
    }
}
```

### **Service Layer (`service.js`)**  
```javascript
export const PaymentOrderService = {
    async create(data) {
        // ONLY business logic and database operations
        const validation = validatePaymentOrderData(data);
        if (!validation.isValid) throw new Error(validation.error);
        
        const paymentOrder = new PaymentOrder(data);
        return await db.collection('paymentOrders').add(paymentOrder.toObject());
    }
};
```

### **Controller Layer (`controller.js`)**
```javascript
export const PaymentOrderController = {
    async create(req, res) {
        // ONLY request/response handling
        try {
            const result = await PaymentOrderService.create(req.body);
            res.json(result);
        } catch (error) {
            res.status(500).json({ error: error.message });
        }
    }
};
```

### **API Service Layer (`services/[feature].service.js`)**
```javascript
export const paymentOrderApiService = {
    async create(data) {
        // ONLY external API calls
        const response = await fetch('/api/payment-orders', {
            method: 'POST',
            body: JSON.stringify(data)
        });
        return response.json();
    }
};
```

### **Utility Layer (`utils/[feature].util.js`)**
```javascript
export const paymentOrderUtils = {
    calculateTotal(items) {
        // ONLY pure utility functions
        return items.reduce((sum, item) => sum + item.amount, 0);
    },
    
    formatOrderId(id) {
        return `PO-${id.slice(-8).toUpperCase()}`;
    }
};
```

### **Component Layer**
```javascript
// ONLY single-responsibility components
export const PaymentOrderForm = ({ onSubmit, initialData }) => {
    // Form logic ONLY - no API calls, no business logic
};

export const PaymentOrderCard = ({ paymentOrder, onEdit }) => {
    // Display logic ONLY
};
```

### **Page Layer**
```javascript
export default function PaymentOrdersPage() {
    // ONLY composition - no business logic, no API calls
    return (
        <div>
            <PaymentOrderGrid />
            <PaymentOrderForm />
        </div>
    );
}
```

---

## üéØ Code Suggestion Guidelines

### **When asked to create a new feature:**
1. **ALWAYS** start with the model layer
2. **ALWAYS** separate utilities into pure functions  
3. **ALWAYS** put business logic in services
4. **ALWAYS** keep controllers thin (request/response only)
5. **ALWAYS** create modular, single-purpose components
6. **ALWAYS** keep pages as composition only

### **When asked to refactor existing code:**
1. **ALWAYS** identify mixed responsibilities
2. **ALWAYS** suggest separating concerns into proper layers
3. **ALWAYS** extract business logic to services
4. **ALWAYS** extract utilities to pure functions
5. **ALWAYS** break large components into smaller ones

### **When suggesting API endpoints:**
```javascript
// ‚úÖ CORRECT Pattern
// route.js
import { PaymentOrderController } from './controller.js';
export async function POST(request) {
    return PaymentOrderController.create(request);
}

// controller.js  
import { PaymentOrderService } from './service.js';
export const PaymentOrderController = {
    async create(req) {
        const result = await PaymentOrderService.create(await req.json());
        return Response.json(result);
    }
};

// service.js
import { PaymentOrder } from './model.js';
export const PaymentOrderService = {
    async create(data) {
        // Business logic here
        return await database.save(new PaymentOrder(data));
    }
};
```

---

## üö® REJECTION CRITERIA

**NEVER suggest code with these anti-patterns:**

```javascript
// ‚ùå NEVER suggest this
export default function BadPage() {
    const [data, setData] = useState([]);
    
    // ‚ùå NO: API call in page
    useEffect(() => {
        fetch('/api/data').then(setData);
    }, []);
    
    // ‚ùå NO: Business logic in page  
    const calculate = () => { /* complex logic */ };
    
    // ‚ùå NO: Inline complex components
    return (
        <div>
            {data.map(item => (
                <ComplexInlineComponent key={item.id} />
            ))}
        </div>
    );
}

// ‚ùå NEVER suggest mixed responsibilities  
export const BadController = {
    async create(req, res) {
        // ‚ùå NO: Business logic in controller
        const total = req.body.items.reduce((sum, item) => sum + item.price, 0);
        
        // ‚ùå NO: Direct DB in controller
        const result = await db.save({ ...req.body, total });
        res.json(result);
    }
};
```

---

## üìã Feature Development Template

**When creating any new feature, suggest this structure:**

```bash
# 1. Model & Schema
src/schemas/[feature].schema.js
src/app/api/[feature]/model.js

# 2. Business Logic
src/app/api/[feature]/service.js
src/utils/[feature].util.js

# 3. API Layer
src/app/api/[feature]/controller.js  
src/app/api/[feature]/route.js
src/services/[feature].service.js

# 4. UI Layer
src/app/components/[feature]/[Feature]Form.js
src/app/components/[feature]/[Feature]Card.js  
src/app/components/[feature]/[Feature]Grid.js
src/app/components/[feature]/index.js

# 5. Page Composition
src/app/dashboard/[feature]/page.js
```

---

## üéØ Current Project Context

- **Tech Stack**: Next.js 14, MongoDB, Material-UI, Shopify API
- **Existing Systems**: Repairs, Tasks, Processes, Materials, Print Layout
- **Current Phase**: Payment Processing & Order Fulfillment System
- **Architecture**: Strict MVC(C) with modular components

**Remember: Every suggestion must fit this modular architecture. No exceptions.**
